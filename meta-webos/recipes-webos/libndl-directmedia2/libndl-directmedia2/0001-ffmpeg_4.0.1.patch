commit 1946d8e09cc63c619d65b5e7acd817e94a55c9c3
Author: peak3d <pfau@peak3d.de>
Date:   Mon Jul 23 17:50:53 2018 +0200

    ready for ffmpeg 4.0.1

diff --git a/src/audioswdecoder.cpp b/src/audioswdecoder.cpp
index 9b3adc8..9a86019 100644
--- a/src/audioswdecoder.cpp
+++ b/src/audioswdecoder.cpp
@@ -125,7 +125,7 @@ int AudioSwDecoder::DecodeAudio(unsigned char* data, int size, double dts, doubl
     if (output_buffer_size_ < output_size)
     {
         NDLLOG(LOGTAG, NDL_LOGD, "%s: buffer allocate %d to %d", __func__, output_buffer_size_, output_size);
-        output_buffer_data_ = (unsigned char*)av_realloc(output_buffer_data_, output_size + FF_INPUT_BUFFER_PADDING_SIZE);
+        output_buffer_data_ = (unsigned char*)av_realloc(output_buffer_data_, output_size + AV_INPUT_BUFFER_PADDING_SIZE);
         output_buffer_size_ = output_size;
     }
 
diff --git a/src/esplayer.cpp b/src/esplayer.cpp
index ae4a572..a8ff947 100644
--- a/src/esplayer.cpp
+++ b/src/esplayer.cpp
@@ -212,22 +212,22 @@ int Esplayer::load(NDL_ESP_META_DATA* meta)
 
         switch (meta->audio_codec) {
             case NDL_ESP_AUDIO_CODEC_MP2:
-                codec_id = CODEC_ID_MP2;
+                codec_id = AV_CODEC_ID_MP2;
                 break;
             case NDL_ESP_AUDIO_CODEC_MP3:
-                codec_id = CODEC_ID_MP3;
+                codec_id = AV_CODEC_ID_MP3;
                 break;
             case NDL_ESP_AUDIO_CODEC_AC3:
-                codec_id = CODEC_ID_AC3;
+                codec_id = AV_CODEC_ID_AC3;
                 break;
             case NDL_ESP_AUDIO_CODEC_EAC3:
-                codec_id = CODEC_ID_EAC3;
+                codec_id = AV_CODEC_ID_EAC3;
                 break;
             case NDL_ESP_AUDIO_CODEC_AAC:
-                codec_id = CODEC_ID_AAC;
+                codec_id = AV_CODEC_ID_AAC;
                 break;
             case NDL_ESP_AUDIO_CODEC_HEAAC:
-                codec_id = CODEC_ID_AAC_LATM;
+                codec_id = AV_CODEC_ID_AAC_LATM;
                 break;
             case NDL_ESP_AUDIO_CODEC_PCM_44100_2CH:
             case NDL_ESP_AUDIO_CODEC_PCM_48000_2CH:
diff --git a/tests/ffmpegreader.cpp b/tests/ffmpegreader.cpp
index 33ec8f0..6a508b6 100755
--- a/tests/ffmpegreader.cpp
+++ b/tests/ffmpegreader.cpp
@@ -46,7 +46,7 @@ size_t av_time_base_to_omx_framerate(AVRational fr) {
 FfmpegReader::~FfmpegReader()
 {
     if(avfctx_)
-        av_close_input_file(avfctx_);
+        avformat_close_input(&avfctx_);
 }
 
 bool FfmpegReader::init(const char* input_file)
@@ -59,7 +59,7 @@ bool FfmpegReader::init(const char* input_file)
         return false;
     }
 
-    result = av_find_stream_info(avfctx_);
+    result = avformat_find_stream_info(avfctx_, NULL);
     if (result < 0) {
         fprintf(stderr, "av_find_stream_info: error %d\n", result);
         return false;
@@ -70,8 +70,8 @@ bool FfmpegReader::init(const char* input_file)
     {
         if(enable_video_ && avfctx_->streams[i]->codec->codec_type==AVMEDIA_TYPE_VIDEO) {
 
-            if((avfctx_->streams[i]->codec->codec_id == CODEC_ID_MPEG2VIDEO)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_H264)
+            if((avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_MPEG2VIDEO)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_H264)
                     ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_HEVC)
               )
             {
@@ -97,10 +97,10 @@ bool FfmpegReader::init(const char* input_file)
             }
 
             switch(avfctx_->streams[i]->codec->codec_id) {
-                case CODEC_ID_MPEG2VIDEO:
+                case AV_CODEC_ID_MPEG2VIDEO:
                     video_codec_ = NDL_ESP_VIDEO_CODEC_H262;
                     break;
-                case CODEC_ID_H264:
+                case AV_CODEC_ID_H264:
                     video_codec_ = NDL_ESP_VIDEO_CODEC_H264;
                     break;
                 case AV_CODEC_ID_HEVC:
@@ -113,12 +113,12 @@ bool FfmpegReader::init(const char* input_file)
             }
         }
         else if(enable_audio_ && avfctx_->streams[i]->codec->codec_type==AVMEDIA_TYPE_AUDIO) {
-            if((avfctx_->streams[i]->codec->codec_id == CODEC_ID_MP2)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_MP3)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_AC3)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_EAC3)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_AAC)
-                    ||(avfctx_->streams[i]->codec->codec_id == CODEC_ID_AAC_LATM)
+            if((avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_MP2)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_MP3)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_AC3)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_EAC3)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_AAC)
+                    ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_AAC_LATM)
                     ||(avfctx_->streams[i]->codec->codec_id == AV_CODEC_ID_PCM_S16LE)
               )
             {
@@ -149,22 +149,22 @@ bool FfmpegReader::init(const char* input_file)
             }
 
             switch(avfctx_->streams[i]->codec->codec_id) {
-                case CODEC_ID_MP2:
+                case AV_CODEC_ID_MP2:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_MP2;
                     break;
-                case CODEC_ID_MP3:
+                case AV_CODEC_ID_MP3:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_MP3;
                     break;
-                case CODEC_ID_AC3:
+                case AV_CODEC_ID_AC3:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_AC3;
                     break;
-                case CODEC_ID_EAC3:
+                case AV_CODEC_ID_EAC3:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_EAC3;
                     break;
-                case CODEC_ID_AAC:
+                case AV_CODEC_ID_AAC:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_AAC;
                     break;
-                case CODEC_ID_AAC_LATM:
+                case AV_CODEC_ID_AAC_LATM:
                     audio_codec_ = NDL_ESP_AUDIO_CODEC_HEAAC;
                     break;
                 case AV_CODEC_ID_PCM_S16LE:
